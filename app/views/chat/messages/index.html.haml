- title params[:channel]

- content_for :header_bottom do
  :javascript
    var lastMessageRecordedAt = '#{@messages.size == 0 ? "" : @messages.last.recorded_at}';
    var lastMessageId         = #{@messages.size == 0 ? 0 : @messages.last.id};
  
    $(document).ready(function(){
      $("label.infield").inFieldLabels();
    
      $.scrollTo('#bottom', { axis: 'y' });
      
      setInterval('loadMessages()', 3000);
    });
    
    function loadMessages(){
      $.getJSON('#{chat_messages_path}',
        { channel:  '#{params[:channel]}',
          since:    lastMessageRecordedAt,
          last_id:  lastMessageId,
          topic:    '#{params[:topic]}',
          search:   '#{params[:search]}'
        },
        function(data){
          if(data.length > 0){
            lastMessageRecordedAt = data[data.length - 1].recorded_at;
            lastMessageId         = data[data.length - 1].id;
            
            var scrollToMessage = isScrollBottom();
            
            for(var x = 0; x <= data.length - 1; x++){
              $('table.messages tr:last').after(data[x].html);
            }
            
            if(scrollToMessage == true)
              $.scrollTo('table.messages tr:last', { axis: 'y' });
          }
        }
      );
    }

%h1 IRC Log

- content_for :menu do
  - form_tag chat_messages_search_path, :method => :get, :id => "irc" do
    = label_tag "search", "Search Logs", :class => 'infield'
    = text_field_tag "search",     params[:search]
    = hidden_field_tag "channel",  params[:channel]
    = hidden_field_tag("full_log", params[:full_log]) if params[:full_log]
    
    - # submit_tag "Search"
  - if @more_messages
    = link_to "Load all messages", chat_messages_path(:channel => params[:channel], :full_log => true, :topic => params[:topic])

%table.messages
  - if @messages.size == 0
    = render :partial => "no_results"
  - else
    - @messages.each do |message|
      = render :partial => "display", :locals => {:message => message}


#bottom